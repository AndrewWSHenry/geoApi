<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Test Page</title>
    <style>
        .layerTile { position: absolute; }
    </style>
</head>
<body>
    <div id='map' style='height:90%; width: 100%;'></div>
    <p id='mess' />
    <script src='dist/geoapi.min.js'></script>
    <script>
        geoapi('http://js.arcgis.com/3.14/', window).then(function (api) {
        var layer = new api.layer.FeatureLayer('http://maps-cartes.ec.gc.ca/ArcGIS/rest/services/CommonGIS_AuxMerc/MapServer/0');

        var legend = [
        {
          'label' : '',
          'url' : 'A3621BE2',
          'imageData' : 'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAAAXNSR0IB2cksfwAAAAZQTFRF/v//AKnn3zVwoAAAAAJ0Uk5TAP9bkSK1AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAG0lEQVQokWNgIBMwYgUQKazqR6VGpfAmGzIAAHXqAFUODW1dAAAAAElFTkSuQmCC',
          'contentType' : 'image/png'
        }
      ];
        layer.on('load', function(evt) {
            console.log('EEEEEEEEEEEEEEEEEEEEEEEEEEEEEE LOADED', layer.renderer);
            console.log(layer);
            console.log(Object.getPrototypeOf(layer.renderer).declaredClass);
            // loadLayerAttribs
            var fData = api.attribs.loadLayerAttribs(layer);
            console.log('GGGGGGGGGGGGGGGGGG fData', fData);

            var oid = 7;
            console.log('FFFFFFFFFFFFFFFFFFFFFFFFFFF', fData[0]);
            fData[0].layerData.then(lData => {
                console.log('IIIIIIIIIIIIIIII renderer', lData.renderer, legend);
                var lconfig = api.symbology.createSymbologyConfig(lData.renderer, legend);
                fData[0].getAttribs().then(gData => {
                    console.log('HHHHHHHHHHHHHHHHH', lconfig, gData);
                    var icon = api.symbology.getGraphicIcon(gData, lconfig, oid);
                    var myimg = document.getElementById('mine');
                    myimg.src = 'data:image/png;base64,' + icon;
                    console.log(icon);
                });
            });
        });
    });
    </script>
    <img id='mine' width='32px' height='32px' border='1px' hspace='20' vspace='20' />
</body>
</html>
